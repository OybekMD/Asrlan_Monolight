asrlan.jprq.app/media/mdata/levels/beginner.png
asrlan.jprq.app/media/mdata/levels/elementary.png
asrlan.jprq.app/media/mdata/levels/preintermidiet.png

INSERT INTO user_lesson (score, user_id, lesson_id, created_at)
VALUES
    (100, '678e9012-e89b-12d3-a456-426614174006', 1, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 2, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 3, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 4, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 5, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 6, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 7, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 8, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 9, '2024-01-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 10, '2024-01-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 11, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 12, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 13, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 14, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 15, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 16, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 17, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 18, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 19, '2024-02-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 20, '2024-02-17'),
	(100, '678e9012-e89b-12d3-a456-426614174006', 21, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 22, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 23, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 24, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 25, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 26, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 27, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 28, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 29, '2024-02-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 30, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 31, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 32, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 33, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 34, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 35, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 36, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 37, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 38, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 39, '2024-03-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 40, '2024-03-17'),
	(100, '678e9012-e89b-12d3-a456-426614174006', 41, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 42, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 43, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 44, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 45, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 46, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 47, '2024-04-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 48, '2024-05-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 49, '2024-05-17' ),
    (100, '678e9012-e89b-12d3-a456-426614174006', 50, '2024-05-17'),
    (100, '678e9012-e89b-12d3-a456-426614174006', 51, '2024-05-17');

INSERT INTO user_lesson (score, user_id, lesson_id, created_at)
VALUES
    (100, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 1, '2024-01-17' ),
    (20, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 2, '2024-01-17' ),
    (100, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 3, '2024-01-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 4, '2024-01-17' ),
    (65, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 5, '2024-01-17' ),
    (50, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 6, '2024-01-17' ),
    (40, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 7, '2024-01-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 8, '2024-01-17' ),
    (20, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 9, '2024-01-17' ),
    (45, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 10, '2024-01-17'),
    (87, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 11, '2024-02-17'),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 12, '2024-02-17'),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 13, '2024-02-17'),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 14, '2024-02-17'),
    (20, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 15, '2024-02-17'),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 16, '2024-02-17'),
    (30, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 17, '2024-02-17'),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 18, '2024-02-17'),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 19, '2024-02-17'),
    (40, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 20, '2024-02-17'),
	(10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 21, '2024-02-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 22, '2024-02-17' ),
    (50, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 23, '2024-02-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 24, '2024-02-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 25, '2024-02-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 26, '2024-02-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 27, '2024-02-17' ),
    (50, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 28, '2024-02-17' ),
    (10, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 29, '2024-02-17' ),
    (60, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 30, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 31, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 32, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 33, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 34, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 35, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 36, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 37, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 38, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 39, '2024-03-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 40, '2024-03-17'),
	(0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 41, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 42, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 43, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 44, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 45, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 46, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 47, '2024-04-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 48, '2024-05-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 49, '2024-05-17' ),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 50, '2024-05-17'),
    (0, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 51, '2024-05-17');

INSERT INTO user_lesson (score, user_id, lesson_id, created_at)
VALUES
    (85, '678e9012-e89b-12d3-a456-426614174006', 21, '2024-02-17' ),
    (92, '678e9012-e89b-12d3-a456-426614174006', 22, '2024-02-17' ),
    (78, '678e9012-e89b-12d3-a456-426614174006', 23, '2024-02-17' ),
    (95, '678e9012-e89b-12d3-a456-426614174006', 24, '2024-02-17' ),
    (88, '678e9012-e89b-12d3-a456-426614174006', 25, '2024-02-17' ),
    (70, '678e9012-e89b-12d3-a456-426614174006', 26, '2024-02-17' ),
    (75, '678e9012-e89b-12d3-a456-426614174006', 27, '2024-02-17' ),
    (82, '678e9012-e89b-12d3-a456-426614174006', 28, '2024-02-17' ),
    (90, '678e9012-e89b-12d3-a456-426614174006', 29, '2024-02-17' ),
    (85, '678e9012-e89b-12d3-a456-426614174006', 30, '2024-01-17'),
    (85, '678e9012-e89b-12d3-a456-426614174006', 31, '2024-01-17'),
    (92, '678e9012-e89b-12d3-a456-426614174006', 32, '2024-01-17'),
    (78, '678e9012-e89b-12d3-a456-426614174006', 33, '2024-01-17'),
    (95, '678e9012-e89b-12d3-a456-426614174006', 34, '2024-01-17'),
    (88, '678e9012-e89b-12d3-a456-426614174006', 35, '2024-01-17'),
    (70, '678e9012-e89b-12d3-a456-426614174006', 36, '2024-01-17'),
    (75, '678e9012-e89b-12d3-a456-426614174006', 37, '2024-01-17'),
    (82, '678e9012-e89b-12d3-a456-426614174006', 38, '2024-01-17'),
    (90, '678e9012-e89b-12d3-a456-426614174006', 39, '2024-01-17'),
    (90, '678e9012-e89b-12d3-a456-426614174006', 40, '2024-01-17');


SELECT 
    lev.id, 
    lev.name, 
    COALESCE(ul.score, 0) AS score,
    lev.real_level, 
    lev.picture 
FROM 
    levels lev
JOIN 
    languages lan ON lev.language_id = lan.id
LEFT JOIN 
    user_level ul ON ul.level_id = lev.id AND ul.user_id = '423e4567-e89b-12d3-a456-426614174004'
WHERE 
    lev.deleted_at IS NULL
    AND lan.deleted_at IS NULL
    AND lan.id = 1
ORDER BY 
    lev.real_level;













func (s *userRepo) Update(ctx context.Context, newUser *repo.User) (*repo.User, error) {
	query := `
	UPDATE
		users
	SET
		name = $1,
		bio = $2,
		birth_day = $3,
		avatar = $4,
		updated_at = CURRENT_TIMESTAMP
	WHERE
		id = $5
	AND
		deleted_at IS NULL
	RETURNING
		id,
		name,
		username,
		bio,
		birth_day,
		email,
		avatar,
		coint,
		score,
		created_at,
		updated_at
	`

	var updatedUser repo.User
	var nullBio, nullBirthDay, nullAvatar sql.NullString
	err := s.db.QueryRowContext(
		ctx,
		query,
		newUser.Name,
		newUser.Bio,
		newUser.BirthDay,
		newUser.Avatar,
		newUser.Id,
	).Scan(
		&updatedUser.Id,
		&updatedUser.Name,
		&nullBio,
		&nullBirthDay,
		&updatedUser.Email,
		&nullAvatar,
		&updatedUser.Coint,
		&updatedUser.Score,
		&updatedUser.CreatedAt,
		&updatedUser.UpdatedAt,
	)
	if err != nil {
		log.Println("Eror updating user in postgres method", err.Error())
		return nil, err
	}
	if nullBio.Valid {
		updatedUser.Bio = nullBio.String
	}
	if nullBirthDay.Valid {
		updatedUser.BirthDay = nullBirthDay.String
	}
	if nullAvatar.Valid {
		updatedUser.Avatar = nullAvatar.String
	}

	if newUser.Username != updatedUser.Username {
		queryUsername := `
		UPDATE
			users
		SET
			username = $1
		WHERE
			id = $2
		AND
			deleted_at IS NULL
		RETURNING
			username
		`
		err = s.db.QueryRowContext(
			ctx,
			query,
			newUser.Username,
			newUser.Id,
		).Scan(&updatedUser.Username,)
	}

	return &updatedUser, nil
}

	SELECT DISTINCT
    u.name,
    u.username,
    u.avatar,
    u.score
FROM
    users u
JOIN
    user_level ulev ON u.id = ulev.user_id
JOIN
    user_lesson ules ON u.id = ules.user_id
WHERE
    ulev.level_id = 1
    AND ules.created_at >= CURRENT_DATE - INTERVAL '1 months'
ORDER BY                     
    u.score DESC;












INSERT INTO user_lesson (score, user_id, lesson_id, created_at)
VALUES
    (20, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 10, '2024-06-24' ),
    (90, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 11, '2024-06-25' ),
    (70, '8a22ae56-d927-11ee-90e4-d8bbc174b998', 12, '2024-06-25');